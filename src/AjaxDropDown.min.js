/*!
 * AjaxDropDown v1.0 | Pawel Bizley Brzozowski | https://github.com/bizley-code/Yii2-AjaxDropDown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{addc:"",ercl:"",erst:"",hecl:"",hest:"",locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smod:!1,swcl:"",swst:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),r="</li>",t='<li class="dropdown-header',o=' style="',l="</a></li>",s="disabled",p=" "+s,d="hidden",D=this.find("ul.ajaxDropDownMenu"),c='<li class="ajaxDropDownLoading';""!==n.locl&&(c+=" "+n.locl),c+='"',""!==n.lost&&(c+=o+n.lost+'"'),c+=">"+n.prba+r;var f=t;""!==n.hecl&&(f+=" "+n.hecl),f+='"',""!==n.hest&&(f+=o+n.hest+'"'),f+=">";var x=n.loca.mcha.replace(/{NUM}/g,n.minq),w=t;""!==n.ercl&&(w+=" "+n.ercl),w+='"',""!==n.erst&&(w+=o+n.erst+'"'),w+=">"+n.loca.erro+r;var g=t;return""!==n.nrcl&&(g+=" "+n.nrcl),g+='"',""!==n.nrst&&(g+=o+n.nrst+'"'),g+=">"+n.loca.nrec+r,this.on("show.bs.dropdown",function(){if(0===D.find("li.ajaxDropDownPages").length){var e=a(this).find("button.ajaxDropDownToggle").data("page");e=1*e;var t=!1,s=f+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',d=s;d+=n.paen;var v=a(this).find("input[type=text]").val();v.length>0?v.length>=n.minq?(d+=n.loca.rcon+" <strong>"+v,d+='</strong></li><li class="divider"></li>'+c,t=!0):d=f+x+r:(d+=n.loca.allr+'</li><li class="divider"></li>'+c,t=!0),D.html(d),t&&a.post(n.url,{query:v,page:e}).fail(function(){D.append(w)}).done(function(e){var r=a.parseJSON(e);if(void 0===r.total&&(r.total=1),void 0===r.page&&(r.page=1),r.data.length){D.find("span.ajaxDropDownTotalPages").text(r.total);for(i in r.data){var t='<li class="ajaxDropDownPages ajaxDropDownPage'+r.page+" ajaxDropDownRecord"+r.data[i].id;""!==n.recl&&(t+=" "+n.recl),D.parent().parent().parent().find("li.ajaxDropDownSelected"+r.data[i].id).length&&(t+=" active"),t+='"',""!==n.rest&&(t+=o+n.rest+'"'),t+='><a href="#" class="ajaxDropDownResult" data-id="'+r.data[i].id+'">',r.data[i].mark&&(t+=n.mabe),t+=r.data[i].value,r.data[i].mark&&(t+=n.maen),t+=l,D.append(t)}if(r.total>1){var s='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(s+=" "+n.swcl),s+='"',""!==n.swst&&(s+=o+n.swst+'"'),s+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(s+=" "+n.prcl),1===r.page&&(s+=p),s+='"',""!==n.prst&&(s+=o+n.prst+'"'),s+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(s+=" "+n.necl),r.page===r.total&&(s+=p),s+='"',""!==n.nest&&(s+=o+n.nest+'"'),s+=">"+n.nebe+n.loca.next+n.neen+l,D.append(s)}}else D.append(g)}).always(function(){a("li.ajaxDropDownLoading").remove()})}}),this.on("click","a.ajaxDropDownNext",function(e){e.preventDefault(),e.stopPropagation(),D.find("a.ajaxDropDownPrev").removeClass(s),D.find("a.ajaxDropDownNext").addClass(s);var r=D.parent().find("button.ajaxDropDownToggle").data("page");if(r=1*r+1,D.find("li.ajaxDropDownPage"+r).length)D.find("li.ajaxDropDownPages").addClass(d),D.find("li.ajaxDropDownPage"+r).removeClass(d),D.find("a.ajaxDropDownNext").removeClass(s);else{var t=D.parent().parent().find("input[type=text]").val();a.post(n.url,{query:t,page:r}).fail(function(){D.append(w)}).done(function(e){var t=a.parseJSON(e);if(t.data.length){D.find(".ajaxDropDownPages").addClass(d),void 0===t.total&&(t.total=1),void 0===t.page&&(t.page=1);for(i in t.data){var p='<li class="ajaxDropDownPages ajaxDropDownPage'+t.page+" ajaxDropDownRecord"+t.data[i].id;""!==n.recl&&(p+=" "+n.recl),D.parent().parent().parent().find("li.ajaxDropDownSelected"+t.data[i].id).length&&(p+=" active"),p+='"',""!==n.rest&&(p+=o+n.rest+'"'),p+='><a href="#" class="ajaxDropDownResult" data-id="'+t.data[i].id+'">',t.data[i].mark&&(p+=n.mabe),p+=t.data[i].value,t.data[i].mark&&(p+=n.maen),p+=l,D.find(".divider.ajaxDropDownInfo").before(p)}t.page<t.total?D.find("a.ajaxDropDownNext").removeClass(s):r=t.total}else D.append(g)})}D.parent().find("button.ajaxDropDownToggle").data("page",r),D.find("span.ajaxDropDownPageNumber").text(r)}),this.on("click","a.ajaxDropDownPrev",function(a){a.preventDefault(),a.stopPropagation(),D.find("a.ajaxDropDownNext").removeClass(s),D.find("a.ajaxDropDownPrev").addClass(s);var e=D.parent().find("button.ajaxDropDownToggle").data("page");e=1*e-1,1>e&&(e=1),D.find("li.ajaxDropDownPages").addClass(d),D.find("li.ajaxDropDownPage"+e).removeClass(d),e>1&&D.find("a.ajaxDropDownPrev").removeClass(s),D.parent().find("button.ajaxDropDownToggle").data("page",e),D.find("span.ajaxDropDownPageNumber").text(e)}),this.on("keyup","input[type=text]",function(){a(this).parent().find("button.ajaxDropDownToggle").data("page",1),a(this).parent().find("ul.ajaxDropDownMenu").find("li.ajaxDropDownPages").remove()}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var r=a(this).data("id"),t=a(this).html(),l=a(this).parent().parent().parent().parent().parent().find("ul.ajaxDropDownResults"),s="[]";if(n.smod&&(l.html(""),a(this).parent().parent().find("li.ajaxDropDownPages").removeClass("active"),s=""),a(this).parent().hasClass("active"))a(this).parent().removeClass("active"),l.find("li.ajaxDropDownSelected"+r).remove();else{a(this).parent().addClass("active"),n.smod&&(s="");var i='<li class="ajaxDropDownSelected'+r;if(""!==n.rscl&&(i+=" "+n.rscl),i+='"',""!==n.rsst&&(i+=o+n.rsst+'"'),i+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(i+=" "+n.rmcl),i+='"',""!==n.rmst&&(i+=o+n.rmst+'"'),i+=' data-id="'+r+'">'+n.rmla+"</a>",""!==n.addc){var p=n.addc.replace(/{ID}/g,r);p=p.replace(/{VALUE}/g,t),i+=p}i+=t+'<input type="hidden" name="'+n.name+s+'" value="'+r+'" /></li>',l.append(i)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault(),a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+a(this).data("id")).removeClass("active"),a(this).parent().remove()}),this}}(jQuery);